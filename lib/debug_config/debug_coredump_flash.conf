# Zephyr coredump stored to flash partition
# Include this overlay for crash diagnostics that survive reboot:
#   list(APPEND OVERLAY_CONFIG "${CMAKE_CURRENT_LIST_DIR}/../../lib/debug_config/debug_coredump_flash.conf")
#
# Also requires a DTS overlay defining a coredump_partition.
# Also requires adding crash_log module to ZEPHYR_EXTRA_MODULES.

# Coredump subsystem — flash backend
CONFIG_DEBUG_COREDUMP=y
CONFIG_DEBUG_COREDUMP_BACKEND_FLASH_PARTITION=y
CONFIG_DEBUG_COREDUMP_MEMORY_DUMP_MIN=y
CONFIG_DEBUG_COREDUMP_SHELL=y

# Flash driver (required for flash partition backend)
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_STREAM_FLASH=y

# Crash log module — boot-time detection + shell commands
CONFIG_CRASH_LOG=y
CONFIG_CRASH_LOG_AUTO_REPORT=y
CONFIG_CRASH_LOG_SHELL=y

# RTT logging (for crash report output and shell)
CONFIG_LOG=y
CONFIG_USE_SEGGER_RTT=y
CONFIG_LOG_BACKEND_RTT=y
CONFIG_LOG_BACKEND_UART=n
CONFIG_RTT_CONSOLE=y
CONFIG_UART_CONSOLE=n

# Larger RTT buffer for coredump output
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=8192

# Larger log buffer to prevent message drops during boot auto-report
CONFIG_LOG_BUFFER_SIZE=4096

# Shell over RTT (buffer 1 to avoid conflict with log backend on buffer 0)
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_RTT=y
CONFIG_SHELL_BACKEND_RTT_BUFFER=1

# Debug-friendly build settings
CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_DEBUG_THREAD_INFO=y
CONFIG_EXTRA_EXCEPTION_INFO=y

# Reboot support (for testing crash → reboot → check cycle)
CONFIG_REBOOT=y
