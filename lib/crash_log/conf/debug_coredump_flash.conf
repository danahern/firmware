# Zephyr coredump stored to flash partition
# Requires: debug_base.conf included first, crash_log in ZEPHYR_EXTRA_MODULES,
#           and a board DTS overlay defining coredump_partition.
#
# Usage in CMakeLists.txt:
#   list(APPEND OVERLAY_CONFIG "${CMAKE_CURRENT_LIST_DIR}/../../lib/crash_log/conf/debug_base.conf")
#   list(APPEND OVERLAY_CONFIG "${CMAKE_CURRENT_LIST_DIR}/../../lib/crash_log/conf/debug_coredump_flash.conf")

# Flash backend
CONFIG_DEBUG_COREDUMP_BACKEND_FLASH_PARTITION=y
CONFIG_DEBUG_COREDUMP_SHELL=y

# Flash driver (required for flash partition backend)
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_STREAM_FLASH=y

# Crash log module — boot-time detection + shell commands
CONFIG_CRASH_LOG=y
CONFIG_CRASH_LOG_AUTO_REPORT=y
CONFIG_CRASH_LOG_SHELL=y

# Larger RTT buffer for coredump output
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=8192

# Larger log buffer to prevent message drops during boot auto-report
CONFIG_LOG_BUFFER_SIZE=4096

# Shell over RTT (buffer 1 to avoid conflict with log backend on buffer 0)
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_RTT=y
CONFIG_SHELL_BACKEND_RTT_BUFFER=1

# Reboot support (for testing crash → reboot → check cycle)
CONFIG_REBOOT=y
